🕐 시간경매 룰 정리

[기본 규칙]
- 게임은 총 5라운드로 진행된다. (기본 5, 변경 가능)
- 각 라운드의 기본 시간은 1분(60초). (변경 가능)
- 최소 2인 이상이 있어야 정상적으로 진행된다.
- 각 참가자는 라운드마다 “참여/불참”을 선택할 수 있다.
  • 3초 이내 응답 없으면 자동 참여 처리

[준비(Ready)]
- 플레이어는 방에 들어와 Ready 상태를 표시해야 한다.
- 모든 인원이 Ready(혹은 방장이 강제 시작)일 때 게임이 시작된다.
- Ready 상태는 라운드 시작 전까지 자유롭게 토글 가능하다.

[라운드 진행]
1) 참여 여부 선택
- 각 플레이어는 라운드 시작 전에 참여 여부를 선택한다.
- 불참을 선택하면 그 라운드에서는 입찰에 영향을 주지 않는다.

2) 시간 집계
- 참여자는 라운드 시간(60초) 안에서 자신의 시간을 “소모”한다.
- 라운드 시작시 3-2-1 카운트한 후 타이머가 자동으로 시작된다.
- 종료 버튼 누르면 입찰이 종료되고, 서버는 time_start 와 time_end를 비교해 소모 시간, 남은 총 시간을 계산한다.
- 남은 시간을 초과해 소모할 수 없다.

3) 라운드 종료/정산
- 라운드 종료 시점까지 소모된 시간을 서버가 집계한다.
- 가장 많은 시간을 소모한 플레이어가 그 라운드 승리자가 된다.

[라운드 승자 판정]
- 기본 승자: 입찰 소모 시간이 가장 큰 사람이 1점 획득.
- timestamp 1단위까지 판별할것이기 때문에 동점은 없겠지만, 동점인 경우 점수 없음.

[최종 승리 조건]
- 5라운드 종료 후:
  • 라운드 승 수가 가장 많은 사람이 최종 승자
  • 승 수가 같으면 남은 시간이 많은 사람이 승자
  • 그래도 같으면 타이브레이커 적용

- 치팅 방지:
  • 최소 토글 간격(예: 50~100ms) 미만의 이벤트는 무효
  • 중복 이벤트는 멱등 처리




⏱ 시간경매 게임 시퀀스 (1분 라운드 × 5라운드)
1. 방 참여 (Join Room)

C → S: 방 참여 요청 (joinRoom)

세션 저장, 방 구독 시작

S → All: 방 참여 확인 브로드캐스트

2. 준비 (Ready)

C → S: 레디 (ready(roomEntryId))

RoomEntry.ready = true

S → All: 레디 상태 업데이트 브로드캐스트

3. 게임 시작 (Game Start)

C → S: 게임 시작 요청 (방장 or 전원 준비 시)

Game 엔티티 생성/저장

레디한 사용자만 참가자로 확정 (옵션: 전원 가능)

S → All: 게임 시작 확인 브로드캐스트

4. 라운드 반복 (5라운드)
4.1 라운드 참여 여부 (RoundIn/Out)

S → All: 라운드 참여 여부 요청 (3초 제한)

3초 내에 선택 안 하면 → 자동 참여 처리

라운드 타이머 시간이 없으면 → 참여 불가

C → S: 라운드 참여/미참여 전송

S → C (개인): 라운드 참여 여부 확인 응답

S → All: 모든 참여 여부가 결정되면 → 라운드 시작

4.2 시간 집계 (Time Auction)

C → S: 시간집계 시작 (TimeStartEvent(sentAt))

클라이언트 보낸 시간 기준으로 기록

S → C (개인): 타이머 시작 확인

C → S: 시간집계 종료 (TimeEndEvent(sentAt))

클라이언트 보낸 종료시간 기준으로 기록

남은 시간(capacity) 내에서만 유효

S → C (개인): 시간집계 종료 확인

4.3 라운드 정산 (Round Settle)

모든 사람의 집계 종료 확인 시

S → All: 라운드 결과 브로드캐스트

각자 이번 라운드 소모 시간, 남은 시간 포함

5. 게임 종료 (Game End)

5라운드 모두 끝나면

S → All: 게임 최종 결과 브로드캐스트

라운드별 소모 시간/남은 시간 표 출력

6. 방 나감 (Leave Room)

C → S: 방 나감 요청 (leftRoom)

S → All: 퇴장 알림 브로드캐스트
(남은 인원=0 → 방 자동 삭제)